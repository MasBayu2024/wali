<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{% block title %}Dashboard{% endblock %}</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

  <style>
    :root{ --sidebar-width:240px; --bg:#f8fafc; --card:#fff; --text:#111827; --muted:#6b7280; --sidebar-bg:#1f2937; --sidebar-link:#d1d5db; --accent:#0d6efd; }
    .dark-mode{ --bg:#06070a; --card:#0f1724; --text:#e6eef8; --muted:#9aa6b2; --sidebar-bg:#0b1220; --sidebar-link:#cbd5e1; --accent:#66b2ff; }

    body{ min-height:100vh; display:flex; background:var(--bg); color:var(--text); transition:background .2s, color .2s; margin:0; font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
    .sidebar{ width:var(--sidebar-width); min-width:var(--sidebar-width); height:100vh; position:fixed; top:0; left:0; background:var(--sidebar-bg); color:var(--sidebar-link); padding:1rem; display:flex; flex-direction:column; }
    .sidebar .brand{ color:#fff; font-weight:700; display:flex; align-items:center; gap:.5rem; margin-bottom:1rem; text-decoration:none; }
    .sidebar .nav-link{ color:var(--sidebar-link); padding:.6rem .75rem; border-radius:.35rem; text-decoration:none; display:flex; align-items:center; gap:.6rem; }
    .sidebar .nav-link:hover, .sidebar .nav-link.active{ background:rgba(255,255,255,0.04); color:#fff; }
    .sidebar .bottom{ margin-top:auto; }

    .content{ margin-left:var(--sidebar-width); padding:1.25rem; width:calc(100% - var(--sidebar-width)); }

    .card{ background:var(--card); border:none; color:var(--text); }

    /* responsive */
    @media (max-width: 768px){
      .sidebar{ transform:translateX(-100%); position:fixed; z-index:1030; }
      .sidebar.show{ transform:translateX(0); }
      .content{ margin-left:0; width:100%; }
      .backdrop{ display:none; }
      .backdrop.show{ display:block; position:fixed; inset:0; background:rgba(0,0,0,.35); z-index:1020; }
    }
  </style>
</head>
<body id="pageBody">

  {% include 'menu.html' %}

  <div id="backdrop" class="backdrop"></div>

  <main class="content">
    <!-- mobile top bar to toggle sidebar -->
    <nav class="navbar navbar-light bg-transparent mb-3 d-md-none">
      <div class="container-fluid px-0">
        <button id="menuToggle" class="btn btn-outline-secondary btn-sm"><i class="fa fa-bars"></i></button>
        <div class="ms-auto">
          <button id="mobileThemeToggle" class="btn btn-outline-secondary btn-sm"><i id="mobileThemeIcon" class="fa-regular fa-moon"></i></button>
        </div>
      </div>
    </nav>

    {% block content %}{% endblock %}
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // sidebar toggle mobile
    const menuToggle = document.getElementById('menuToggle');
    const sidebar = document.getElementById('sidebar');
    const backdrop = document.getElementById('backdrop');
    if(menuToggle){ menuToggle.addEventListener('click', ()=>{ sidebar.classList.toggle('show'); backdrop.classList.toggle('show'); }); }
    if(backdrop) backdrop.addEventListener('click', ()=>{ sidebar.classList.remove('show'); backdrop.classList.remove('show'); });

    // theme toggle persistent
    const pageBody = document.getElementById('pageBody');
    const mobileToggle = document.getElementById('mobileThemeToggle');
    const desktopToggle = document.getElementById('desktopThemeToggle');
    const mobileIcon = document.getElementById('mobileThemeIcon');
    const desktopIcon = document.getElementById('desktopThemeIcon');
    const THEME_KEY = 'dashboard_theme';

    function applyTheme(theme){
      if(theme==='dark'){ pageBody.classList.add('dark-mode'); if(mobileIcon) mobileIcon.className='fa-solid fa-sun'; if(desktopIcon) desktopIcon.className='fa-solid fa-sun'; }
      else { pageBody.classList.remove('dark-mode'); if(mobileIcon) mobileIcon.className='fa-regular fa-moon'; if(desktopIcon) desktopIcon.className='fa-regular fa-moon'; }
    }

    (function(){
      const saved = localStorage.getItem(THEME_KEY);
      if(saved) applyTheme(saved);
      else { applyTheme(window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'); }
    })();

    function toggleTheme(){ const isDark = pageBody.classList.contains('dark-mode'); const newTheme = isDark ? 'light' : 'dark'; applyTheme(newTheme); localStorage.setItem(THEME_KEY, newTheme); }
    if(mobileToggle) mobileToggle.addEventListener('click', toggleTheme);
    if(desktopToggle) desktopToggle.addEventListener('click', toggleTheme);
  </script>
</body>
</html>
